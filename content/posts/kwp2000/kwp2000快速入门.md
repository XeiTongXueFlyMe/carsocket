---
title: "Kwp2000快速入门"
date: 2018-02-03T15:09:36+08:00
draft: false
keywords: [ "kwp2000","EOBD"]
categories: "kwp2000"
tags: [ "kwp2000","EOBD" ]

# you can close something for this content if you open it in config.toml.
comment: true
toc: false
# you can define another contentCopyright. e.g. contentCopyright: "This is an another copyright."
contentCopyright: false
reward: false
mathjax: false
---

# kwp2000入门

欧洲汽车领域广泛使用的一种车载诊断协议标准是KWP2000（Keyword Protocol 2000），该协议实现了一套完整的车载诊断服务，并且满足E-OBD（European On Board Diagnose）标准。KWP2000最初是基于K线的诊断协议（ISO 14230），近年来欧洲汽车领域广泛采用了基于CAN总线的KWP2000（ISO 15765），而基于K线的KWP2000物理层和数据链路层协议将逐步被淘汰。

---------------------------------------

# 基于K线和CAN线的KWP2000协议OSI模型

---------------------------------------

|OSI模型|K线|CAN线|
|---|---|---|
|应用层|ISO 14230-3|ISO 15765-3|
|表示层|无|无|
|会话层|无|无|
|传输层|无|无|
|链路层|无|ISO 15765-2|
|网络层|ISO 14230-2|ISO 11898-1|
|物理层|ISO 14230-1，ISO 9141-2|自定（双绞线等）|

---------------------------------------

1. ISO 14230-1规定了KWP2000协议的物理层规范（K线、L线），它在ISO 9141-2的基础上把数据交换系统扩展到了24V电压系统。
2. ISO 14230-2规定了KWP2000的数据链路层协议，包括报文结构、初始化过程、通讯连接管理、定时参数和错误处理等内容。
3. ISO 15765-3协议，该协议完全兼容基于K线的应用层协议14230-3
4. ISO/WD 15765-1～15765-4，该协议把KWP2000应用层的诊断服务移植到CAN总线上，基于CAN总线的KWP2000协议实际上指的就是ISO 15765-1～15765-4。

 > K线的报文包括报文头、数据域和校验和三部分，其中报文头包含格式字节、目标地址（可选）、源地址（可选）和附加长度信息（可选），具体格式参阅ISO 14230-2。

 > can线规定了网络层的格式（N_PDU），格式包括地址信息，协议控制信息，数据域（N_AI,N_PCI,N_DATA）。应用层协议规定了四种服务数据结构，<Service_Name>.Request、<Service_Name>.Indication、<Service_Name>.Response和<Service_Name>.Confirm，分别用于诊断设备（Tester）的服务请求、ECU的服务指示、ECU的服务响应和Tester的服务确认。这些数据结构中包含了地址信息、服务请求ID和服务请求参数等内容。

# kwp2000数据连接口
## 根据ISO DIS 15031–3中相关内容，DLC是一个如下16针的插座

![OBD插座图](http://res.cloudinary.com/xeitongxueflyme/image/upload/v1517623820/OBDjiekoutu_cmew5c.png)

## 各个针脚定义如下：

![OBD插座图](http://res.cloudinary.com/xeitongxueflyme/image/upload/v1517623808/OBDJIEKOUMIAOshu_egld52.png)

> 1, 3, 8, 9, 11, 12 和13 未做分配，可由车辆制造厂定义。

> 2, 6, 7, 10, 14 和 15 使用作诊断通讯的。根据实际使用的通讯协议的不同，它们往往不会都被使用，为使用的可由车辆制造厂定义。
 